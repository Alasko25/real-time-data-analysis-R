---
title: "Customer Churn Report"
output: pdf_document
params:
  data: NULL
  history: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(ggplot2)
library(DataExplorer)
library(psych)

introduce(params$data)
plot_missing(params$data)
plot_histogram(params$data)

cor_matrix <- cor(params$data)
psych::corr.test(params$data)$p  # p-values

plot_correlation(params$data)

if (!is.null(params$history)) {
  df <- data.frame(epoch = 1:length(params$history$metrics$loss),
                   loss = params$history$metrics$loss,
                   acc = params$history$metrics$accuracy)

  ggplot(df, aes(x = epoch)) +
    geom_line(aes(y = loss, color = "Loss")) +
    geom_line(aes(y = acc, color = "Accuracy")) +
    labs(y = "Metric", title = "Loss & Accuracy during Training") +
    theme_minimal()
}
